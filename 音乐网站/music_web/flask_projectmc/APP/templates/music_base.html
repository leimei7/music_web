<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音乐网站</title>
    <!-- 引入Bootstrap CSS -->
    <link href={{ url_for('static',filename='bootstrap.min.css' ) }} rel="stylesheet">
    <style>
        body {
            display: flex;
            height: 100vh;
        }

        #sidebar {
            background-color: #f8f9fa;
            padding: 20px;
            border-right: 1px solid #dee2e6;
        }

        #content {
            flex-grow: 1;
            padding: 20px;
        }

        #qrcode-container {
            display: none;
            text-align: center; /* 让二维码居中显示 */
        }
    </style>
</head>

<body>
    <div class="container-fluid h-100">
        <div class="row h-100">
            <div id="sidebar" class="col-md-3 d-flex flex-column align-items-start">
                <form action="/select/" method="POST" style="width: 100%;">
                    <div class="input-group mb-3">
                        <input type="text" name="search" class="form-control" placeholder="搜索音乐..."
                            aria-label="Recipient's username" aria-describedby="basic-addon2">
                        <button type="submit" class="input-group-text bg-info">搜索</button>
                    </div>
                </form>

                <ul class="nav flex-column mx-auto w-100 text-center mt-5">
                    <li class="nav-item" id="li1">
                        <a class="nav-link active text-black btn" href="/collect/1/" id="myCollection">我的收藏</a>
                    </li>
                    <hr>
                    <li class="nav-item" id="li2">
                        <a class="nav-link active text-black btn" href="/download/" id="myDownloads">我的下载</a>
                    </li>
                    <hr>
                    <li class="nav-item" id="li3">
                        <a class="nav-link active text-black btn" href="/admin/" id="mySet">账号管理</a>
                    </li>
                    <hr>
                    <li class="nav-item" id="li4">
                        <a class="nav-link active text-black btn" href="/upgrade/" id="upGrade">更新日志</a>
                    </li>
                </ul>

                <div class="container" style="margin-top:50%;">
                    <div class="row justify-content-center">
                        <div class="col-md-4">
                            <div class="d-flex justify-content-center align-items-center flex-column">
                                <img src='{{ url_for('static',filename='头像.jpg' ) }}' class="rounded-circle mb-3"
                                    alt="User Avatar" width="100" height="100" id="avatar">
                                <h5 class="text-center mb-0">{{ name }}</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% block content %}
            <div id="content" class="col-md-9 d-flex flex-column justify-content-center align-items-center">
                <h1>欢迎来到音乐世界</h1>
                <p>点击左侧的功能键查看内容</p>
                <p class="text-warning">全新2.0.1抢先版</p>
                <a href="http://chat.314singularity.cn/?from_allowed_site=true" style="text-decoration: none;">
                    <img src="{{ url_for('static',filename='宋.png' ) }}" alt="User Avatar" width="100" height="100" id="avatar" class="rounded">
                </a>
            </div>
            {% endblock %}
        </div>
    </div>

    <!-- 登录模态框 -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">登录提示</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <span id="login-prompt">是否登录？</span>
                    <div id="qrcode-container">
                        <img id="qrcode-img" src="" alt="QR Code">
                    </div>
                    <div id="login-status" style="display: none;">登录成功</div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">否</button>
                    <button type="button" class="btn btn-primary" id="loginYesBtn">是</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 引入Bootstrap JS和依赖的Popper.js -->
    <script src={{ url_for('static',filename='bootstrap.min.js' ) }}></script>
</body>
<script>
    let box = document.getElementById('sidebar')
    let li1 = document.getElementById('li1')
    let li2 = document.getElementById('li2')
    let li3 = document.getElementById('li3')
    let li4 = document.getElementById('li4')
    let theme = {{ theme }}
    if (theme === 2) {
        box.style.backgroundColor = '#8FBC8F'
        li1.style.backgroundColor = '#FFB6C1'
        li2.style.backgroundColor = '#FFB6C1'
        li3.style.backgroundColor = '#FFB6C1'
        li4.style.backgroundColor = '#FFB6C1'
    }
    else if (theme === 3) {
        box.style.backgroundColor = '#FFA500'
        li1.style.backgroundColor = '#FFFFA0'
        li2.style.backgroundColor = '#FFFFA0'
        li3.style.backgroundColor = '#FFFFA0'
        li4.style.backgroundColor = '#FFFFA0'
    }

    // 添加头像点击事件监听器
    // 添加头像点击事件监听器
    let avatar = document.getElementById('avatar');
    let loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
    avatar.addEventListener('click', function () {
        loginModal.show();
    });
    
    // 处理点击“是”按钮的事件
    let loginYesBtn = document.getElementById('loginYesBtn');
    let qrcodeContainer = document.getElementById('qrcode-container');
    let qrcodeImg = document.getElementById('qrcode-img');
    let loginStatus = document.getElementById('login-status');
    let loginPrompt = document.getElementById('login-prompt');
    loginYesBtn.addEventListener('click', function () {
        // 发送AJAX请求到/newlogin/qrcode/
        fetch('/newlogin/qrcode/')
           .then(response => response.json())
           .then(data => {
                if (data.qr_code_base64) {
                    // 显示二维码
                    qrcodeImg.src = 'data:image/png;base64,' + data.qr_code_base64;
                    qrcodeContainer.style.display = 'block';
                    // 修改提示文字
                    loginPrompt.textContent = '请用QQ扫码';
                    // 定时检查登录状态
                    let intervalId = setInterval(() => {
                        fetch('/newlogin/check_status/')
                           .then(response => response.json())
                           .then(statusData => {
                                if (statusData.success) {
                                    clearInterval(intervalId);
                                    qrcodeContainer.style.display = 'none';
                                    // 更新登录状态文本为更具体的 message
                                    loginStatus.textContent = statusData.message;
                                    loginStatus.style.display = 'block';
                                }
                            });
                    }, 1000);
                } else {
                    console.log('获取二维码失败');
                }
            })
           .catch(error => {
                console.error('请求出错:', error);
            });
    });
</script>

</html>
    